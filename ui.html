<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" type="text/css" href="css/style.css">
	</head>
  <body style="margin: 0px;">
    <div style="display: flex;flex-direction: column;height: 100%;">
			<div
				style="
					height: 42px;
					display: flex;
					flex-shrink: 0;
					align-items:center;
					justify-content: start;
					padding: 0px 12px;
					border-bottom: 1px solid #CDCDCDFF;
				">
				<div id="list-button"></div>
					tool bar
				</div>
			<div style="flex-grow: 1;overflow: auto;">
				<ul id="variables-collection">
				</ul>
				<div id="color-variables">
				</div>
			</div>
			<div id="generate-button-container"
				style="
					height: 60px;
					display: flex;
					flex-shrink: 0;
					align-items:center;
					justify-content: end;
					padding: 0px 12px;
					border-top: 1px solid #CDCDCDFF;
				">
				<div id="generate-button"></div>
			</div>
    </div>
  </body>
  <script type="module">
		// const generateButton = document.querySelector('#generate-button');
		// const generateButton = Button({label: 'Generate'});
    window.onmessage = (event) => {
      const { name, content } = event.data.pluginMessage;
      console.log(content);
      if (name === "get-variable-collections") {
				const { collections } = content;
        const list = document.querySelector("#variables-collection");
        list.innerHTML = "";
        collections.forEach(({ name, id, variableIds }) => {
          const li = document.createElement("li");
          li.textContent = name;
          li.setAttribute("id", `collection-${id}`);
          li.onclick = () => {
            parent.postMessage(
              {
                pluginMessage: {
                  type: "get-variable-group",
                  id,
                  variableIds
                },
              },
              "*"
            );
          };
          list.appendChild(li);
        });
      } else if (name === 'get-collection-variables') {
				const { variables } = content;
        const colorVariablesDiv = document.querySelector("#color-variables");
        colorVariablesDiv.innerHTML = "";
        variables.forEach(({ name, valuesByMode }) => {
          const div = document.createElement("div");
          div.textContent = `${name}: value`;
          colorVariablesDiv.appendChild(div);
        });
      }
			if (name === "create-element") {
				const { tag, attribute, children, parentElement } = content;
				console.log(tag, attribute, children);

				const element = document.createElement(tag);

				if (children) {
					element.innerHTML = children;
				}

				if (!!(attribute && Object.keys(attribute).length)) {
					for (const [key, value] of Object.entries(attribute)) {
						if (key === "style") {
							for (const [styleKey, styleValue] of Object.entries(value)) {
								element.style[styleKey] = styleValue;
							}
						} else if (typeof value === "string") {
							element.setAttribute(key, value);
						}
					}
				}

				// Mount to parent element
				let parent;
				if (parentElement) {
					parent = document.querySelector(parentElement);
				}
				parent.appendChild(element);
			}
    };

  </script>
</html>
